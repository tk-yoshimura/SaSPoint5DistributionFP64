// Author and Approximation Formula Coefficient Generator: T.Yoshimura
// Github: https://github.com/tk-yoshimura
// Original Code: https://github.com/tk-yoshimura/SaSPoint5DistributionFP64
// Yoshimura, T., "Numerical Evaluation and High Precision Approximation Formula for SαS point5 Distribution", July 2024.
// https://www.researchgate.net/publication/382124528_Numerical_Evaluation_and_High_Precision_Approximation_Formula_for_SaS_point5_Distribution

using SaSPoint5DistributionFP128.InternalUtils;
using SaSPoint5DistributionFP128.RandomGeneration;
using System.Collections.ObjectModel;
using System.Diagnostics;
using Float128 = MultiPrecision.MultiPrecision<MultiPrecision.Pow2.N4>;

namespace SaSPoint5DistributionFP128 {
    [DebuggerDisplay("{ToString(),nq}")]
    public class SaSPoint5Distribution {

        public Float128 Mu { get; }

        public Float128 C { get; }

        private readonly Float128 c_inv;

        private static readonly Float128 entropy_base = "3.6399244456803064957308496039071853510";


        public SaSPoint5Distribution() : this(mu: 0d, c: 1d) { }

        public SaSPoint5Distribution(Float128 c) : this(mu: 0d, c: c) { }

        public SaSPoint5Distribution(Float128 mu, Float128 c) {
            if (!Float128.IsFinite(mu)) {
                throw new ArgumentOutOfRangeException(nameof(mu), "Invalid location parameter.");
            }
            if (!(c > 0 && Float128.IsFinite(c))) {
                throw new ArgumentOutOfRangeException(nameof(c), "Invalid scale parameter.");
            }

            Mu = mu;
            C = c;

            c_inv = 1d / c;
        }

        public Float128 PDF(Float128 x) {
            Float128 u = (x - Mu) * c_inv;

            if (Float128.IsNaN(u)) {
                return Float128.NaN;
            }
            if (Float128.IsInfinity(u)) {
                return 0d;
            }

            Float128 pdf = PDFPade.Value(u) * c_inv;

            return pdf;
        }

        public Float128 CDF(Float128 x, Interval interval = Interval.Lower) {
            Float128 u = (x - Mu) * c_inv;

            if (Float128.IsNaN(u)) {
                return Float128.NaN;
            }

            Float128 cdf = (interval == Interval.Lower) ? CDFPade.Value(-u) : CDFPade.Value(u);

            return cdf;
        }

        public Float128 Quantile(Float128 p, Interval interval = Interval.Lower) {
            if (!(p >= 0d && p <= 1d)) {
                return Float128.NaN;
            }

            if (interval == Interval.Lower) {
                Float128 x = Mu - C * QuantilePade.Value(p);

                return x;
            }
            else {
                Float128 x = Mu + C * QuantilePade.Value(p);

                return x;
            }
        }

        public double Sample(Random random) {
            double u = random.NextUniformOpenInterval01() - 0.5d;
            double w = random.NextUniformOpenInterval01();

            double cu = double.CosPi(u);

            double r = double.SinPi(u * 0.5d) * double.CosPi(u * 0.5) / (double.Log(w) * cu * cu);

            double v = r * (double)C + (double)Mu;

            return v;
        }

        public bool Symmetric => true;

        public Float128 Median => Mu;

        public Float128 Mode => Mu;

        public Float128 Mean => Float128.NaN;

        public Float128 Variance => Float128.NaN;

        public Float128 Skewness => Float128.NaN;

        public Float128 Kurtosis => Float128.NaN;

        public Float128 Entropy => entropy_base + Float128.Log(C);

        public Float128 Alpha => 0.5d;

        public Float128 Beta => 0d;

        public static SaSPoint5Distribution operator +(SaSPoint5Distribution dist1, SaSPoint5Distribution dist2) {
            return new(dist1.Mu + dist2.Mu, ExMath.Square(Float128.Sqrt(dist1.C) + Float128.Sqrt(dist2.C)));
        }

        public static SaSPoint5Distribution operator -(SaSPoint5Distribution dist1, SaSPoint5Distribution dist2) {
            return new(dist1.Mu - dist2.Mu, ExMath.Square(Float128.Sqrt(dist1.C) + Float128.Sqrt(dist2.C)));
        }

        public static SaSPoint5Distribution operator +(SaSPoint5Distribution dist, Float128 s) {
            return new(dist.Mu + s, dist.C);
        }

        public static SaSPoint5Distribution operator -(SaSPoint5Distribution dist, Float128 s) {
            return new(dist.Mu - s, dist.C);
        }

        public static SaSPoint5Distribution operator *(SaSPoint5Distribution dist, Float128 k) {
            return new(dist.Mu * k, dist.C * k);
        }

        public static SaSPoint5Distribution operator /(SaSPoint5Distribution dist, Float128 k) {
            return new(dist.Mu / k, dist.C / k);
        }

        public override string ToString() {
            return $"{typeof(SaSPoint5Distribution).Name}[mu={Mu},c={C}]";
        }

        public string Formula => "p(x; mu, c) := stable_distribution(x; alpha = 1/2, beta = 0, mu, c)";

        private static class PDFPade {
            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_0_0p0625 = new(
                new ReadOnlyCollection<Float128>([
                    "6.36619772367581343075535053490057448138e-1",
                    "7.57459506929453385798277946154823008327e2",
                    "4.46717322844023441698710451505816706570e5",
                    "1.71501459971530549476153273173061194095e8",
                    "4.76700973495278431084530045707075552432e10",
                    "1.01328150775099946510145440412520620021e13",
                    "1.70028222513668830210058353057559790101e15",
                    "2.29641781943744384078006991488193839955e17",
                    "2.52611994112742436432957758588495082163e19",
                    "2.27833177267552931459542318826727288124e21",
                    "1.68946162731840551853993619351896931533e23",
                    "1.02965010233956763504899745874128908220e25",
                    "5.14128569264874914146628076133997950655e26",
                    "2.09103580386900060922163883603492216942e28",
                    "6.86778299087452621293332172137014749128e29",
                    "1.80029712249744334924217328667885673985e31",
                    "3.70890080432228368476255091774238573277e32",
                    "5.88600513999992354909078399482884993261e33",
                    "7.01189178534848836605739139176681647755e34",
                    "6.06531475170803043941021113424602440078e35",
                    "3.64956999370443524098457423629252855270e36",
                    "1.44276098283517934229787916584447559248e37",
                    "3.45856704224433991524661028965741649584e37",
                    "4.47263237190968408624388275549716907309e37",
                    "2.66186300951901408251743228798832386260e37",
                    "5.48064966533519934186356663849904556319e36",
                    "1.64877082086372991309408001661535573441e35",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "1.18981461118065892086304195732751798634e3",
                    "7.01761929839041982958990681130944341399e5",
                    "2.69465252239913021973760046507387620537e8",
                    "7.49221044103838155300076098325950584061e10",
                    "1.59327386289821190042576978177896481082e13",
                    "2.67528179803224728786405503232064643870e15",
                    "3.61672367849271591791062829736720884633e17",
                    "3.98395893917909208201801908435620016552e19",
                    "3.60025693881358827551113845076726845495e21",
                    "2.67730578745705562356709169493821118109e23",
                    "1.63843883526710042156562706339553092312e25",
                    "8.23075214698024188140971761421762265880e26",
                    "3.37775321923937393366376907114580842429e28",
                    "1.12444724625354796650300159037364355605e30",
                    "3.00860835602766063447009568106012449767e31",
                    "6.39614080159468893509273006948526469708e32",
                    "1.06547095715472468415058181351212520255e34",
                    "1.36755997709303811764051969789337337957e35",
                    "1.32519530489892818585066019217287415587e36",
                    "9.45230390606834183602522256278256501404e36",
                    "4.80344475131699029428900627020022801971e37",
                    "1.66469314795307459840482483320814279444e38",
                    "3.70209065673736156218117594311801487932e38",
                    "4.84490531246108754748100009460860427732e38",
                    "3.30215083398643966091721732133851539475e38",
                    "9.58032845332990262754766784625271262271e37",
                    "7.50461648438613634025964361513066059697e36",
                ])
            );
            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_0p0625_0p125 = new(
                new ReadOnlyCollection<Float128>([
                    "5.46416716200748206779925127900698754119e-1",
                    "4.41771273526123373239570033672829787791e1",
                    "1.56142610225585235535211648703534340871e3",
                    "3.15655694129872563686497490176725921724e4",
                    "4.00791883661952751945853742455643714995e5",
                    "3.30252591667828615354689186280704562254e6",
                    "1.76168115448224677276551213052798322583e7",
                    "5.88534624532179841393387625270218172719e7",
                    "1.14740447137831585842166880265350244623e8",
                    "1.14904082614021239315925958812100948136e8",
                    "4.76866867279164114004579652405104553404e7",
                    "4.53475339598769347326916978463911377965e6",
                    "-1.88896160275915786487519266368539625326e5",
                    "1.05543800791717482823610940401201712196e4",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "8.44407579416524903840331499438398472639e1",
                    "3.15911780811299460009161345260146251462e3",
                    "6.88457596285725454686358792906273558406e4",
                    "9.66501639812506059997744549411633476528e5",
                    "9.12674134216028769532305433586266118000e6",
                    "5.87676063477990584593444083577765264392e7",
                    "2.56084282739608760299329382263598821653e8",
                    "7.34250986378665047914811630036201995871e8",
                    "1.31288233106689286803200674021353188597e9",
                    "1.33621494302241474082474689597125896975e9",
                    "6.63379428046258653791600947328520263412e8",
                    "1.14558538557562267533922961110917101850e8",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_0p125_0p25 = new(
                new ReadOnlyCollection<Float128>([
                    "4.35668401768623200524372663239480799018e-1",
                    "2.30066509937988171489091367354416214000e1",
                    "5.05924026744937322690717755156090122074e2",
                    "6.12998524955326375684693500551926325112e3",
                    "4.52237930808361186011042950178715609183e4",
                    "2.10734809597587633852077152938985998879e5",
                    "6.20796157836149826988172603622242119074e5",
                    "1.12398478061053302537736799402801934778e6",
                    "1.17841330491647012385157454335820786724e6",
                    "6.46281413765362795389526259057436151953e5",
                    "1.52220357379402116641048490644093497829e5",
                    "8.51130316105543847380510577656570543736e3",
                    "-2.32201781975497810173532067354797097401e2",
                    "8.96874547436310030183519174847668703774e0",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "5.63164311578114868477819520857286165076e1",
                    "1.34964379844144961683927306966955217328e3",
                    "1.82966031793809959278519002412667883288e4",
                    "1.56215285850856046267451500310816276675e5",
                    "8.81046679663412610005501878092824281161e5",
                    "3.33868038251479411246071640628518434659e6",
                    "8.46262495881941625571640264458627940579e6",
                    "1.40052628730443097561652737049917920495e7",
                    "1.44394803828297754346261138417756941544e7",
                    "8.56647617803506258343236509255155360957e6",
                    "2.53513095899009948733175317927025056561e6",
                    "2.69130675750530663088963759279778748696e5",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_0p25_0p5 = new(
                new ReadOnlyCollection<Float128>([
                    "2.95645445681747568731488283573032414811e-1",
                    "6.83246437763964151893665752064650172391e0",
                    "6.85333417559435252576820440080930004674e1",
                    "3.90974714199542064991001365628659054084e2",
                    "1.39707205668285805800884524044738261436e3",
                    "3.24814598419826565698241508792385416075e3",
                    "4.95012897118808793886195172068123345314e3",
                    "4.87265743900139300849404272909665705025e3",
                    "2.98795164648056126707212245325405968413e3",
                    "1.07012128790318535418330629467906917213e3",
                    "1.99797198893523173981812955075412130913e2",
                    "1.55029227544167913873724286459253168886e1",
                    "2.54064889901609722583601330171719819660e-1",
                    "-1.72254289950537680833853394958874977464e-3",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "2.58291085070053442257438623486099473087e1",
                    "2.95618461039379226195473938654286975682e2",
                    "1.97427161745150579714266897556974326502e3",
                    "8.52730436681412535198281529590508861106e3",
                    "2.49521185356761585062135933350225236726e4",
                    "5.03881178612341724262911142022761966061e4",
                    "7.02360046338629039644581819847209730553e4",
                    "6.65580339066083507998465454599272345735e4",
                    "4.15462499626138125314518636645472893045e4",
                    "1.61951767959774678843021179589300545717e4",
                    "3.60745557054877240279811529503888551492e3",
                    "3.91061555870569579915258835459255406575e2",
                    "1.43045229010040855016672246098687100063e1",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_0p5_1 = new(
                new ReadOnlyCollection<Float128>([
                    "1.70762401725206223811383500786268939645e-1",
                    "2.19353011456197635663058525904929358535e0",
                    "1.22974648900600015961253465796487372402e1",
                    "3.91951696059042324975935209295355569292e1",
                    "7.79039444119906169910281912009369164227e1",
                    "1.00089963120992100860902142265631127046e2",
                    "8.37108883429306700857182028809960789020e1",
                    "4.49586566873564432788366931251358248417e1",
                    "1.49790521605774884174840168128255220471e1",
                    "2.90660338063979435668763608259382712726e0",
                    "2.93409982383888149064797608605579930804e-1",
                    "1.22802459215932860445033185874876812040e-2",
                    "1.07739227340181463034286653569468171767e-4",
                    "-4.02669738424010290973023004028523684766e-7",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "1.46404480283267324138113869370306506431e1",
                    "9.54550184643308468933661600211579108422e1",
                    "3.63602410602063476726031476852965502123e2",
                    "8.94463479638213888403144706176973026333e2",
                    "1.48607087483870766806529883069123352339e3",
                    "1.69715692924508994524755312953665710218e3",
                    "1.33237849965272853370191827043868842100e3",
                    "7.08460086451666825383009487734769646087e2",
                    "2.47365552394788536087148438788608689300e2",
                    "5.38010282703940184371247559455167674975e1",
                    "6.67219842525655806370702248122668214685e0",
                    "4.01852843874982199859775136086676841910e-1",
                    "8.14767043526088185802569803397824432028e-3",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_1_2 = new(
                new ReadOnlyCollection<Float128>([
                    "8.61071469126041183247373313827161939454e-2",
                    "4.35837460186564880289965856498718321896e-1",
                    "9.47783071967681246738651796742079530382e-1",
                    "1.16019502727107539284403003943433359877e0",
                    "8.80510046274709592896987229782879937271e-1",
                    "4.30456542768955299533391113704078540955e-1",
                    "1.36539167913428133313942008990965988621e-1",
                    "2.76450743657913389896743235938695682829e-2",
                    "3.42847090205575096649865021874905747106e-3",
                    "2.41380341540026027117735179862124402398e-4",
                    "8.40549721587212773424211923602910622515e-6",
                    "1.09089653391032945883918434200567278139e-7",
                    "2.21403900721572475664926557233205232491e-10",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "6.13172035933794917563324458011617112124e0",
                    "1.65687100738157412154132860910003018338e1",
                    "2.59672433683883998168388916533196510994e1",
                    "2.61469557815097583209668778301921207455e1",
                    "1.77070955301136405523492329700943077340e1",
                    "8.20825570431301943907348077675777546304e0",
                    "2.60136197167727810483751794121979805142e0",
                    "5.53723076053642006159503073104152703814e-1",
                    "7.63397465217490984394478518334313362490e-2",
                    "6.40577918603319523990542237990107206371e-3",
                    "2.94376458316662573143947719026985667328e-4",
                    "6.09333568224541559157192543410988474886e-6",
                    "3.59947287428695057506683902409023760438e-8",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_2_4 = new(
                new ReadOnlyCollection<Float128>([
                    "3.91428580496513429479068747515164587814e-2",
                    "9.69015019070193436467106672180804948494e-2",
                    "1.03147451266231819912643754579290008651e-1",
                    "6.18825170881552297150779588545792258740e-2",
                    "2.30548850262278582401286533053286406505e-2",
                    "5.54315108501815531776138839512564427279e-3",
                    "8.66434584176931077662201101557716482514e-4",
                    "8.66158632576958238392567355014249971287e-5",
                    "5.31365802206301246598393821671437863818e-6",
                    "1.85378389166807263837732376845556856416e-7",
                    "3.20375363151456683883984823721339648679e-9",
                    "2.06637401794693307359898089790558771957e-11",
                    "2.08663671047376684678494625068451888284e-14",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "3.07443397096591141329212291707948432414e0",
                    "4.16665031056584124503224711639009530348e0",
                    "3.27666060511630720485121299731204403783e0",
                    "1.65646979169107732387032821262953301311e0",
                    "5.63594064986880863092994744424349361396e-1",
                    "1.31360114173642293100378020953197965181e-1",
                    "2.09489929949457075237756409511944811481e-2",
                    "2.24574519309785870806550506199124944514e-3",
                    "1.56048486483867679310086683710523566607e-4",
                    "6.60417286783794818094722636906776809193e-6",
                    "1.53154117367296710469692755461431646999e-7",
                    "1.60041713691072903334637560080298818163e-9",
                    "4.77381528950794767694352468734042252745e-12",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_4_8 = new(
                new ReadOnlyCollection<Float128>([
                    "1.65057384221262866484014802392420311075e-2",
                    "1.92801687242885330588201777283015178448e-2",
                    "9.65508815862861196424333614846876229064e-3",
                    "2.71545573465295958468808641544341412235e-3",
                    "4.72077718130407940498710469661947719216e-4",
                    "5.26299620525538984108147098966692839348e-5",
                    "3.77971404992990847565880351976461271350e-6",
                    "1.71176235845517643695464740679643640241e-7",
                    "4.64603919225244695533557520384631958897e-9",
                    "6.85274347406803894317891882905083368489e-11",
                    "4.48564096627181435612831469651920186491e-13",
                    "6.90886715044580341917806394089282500340e-16",
                    "-6.39396206221935864416563232680283312796e-19",
                    "8.37760675743046300528308203869876086823e-22",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "1.49023284463742780238035958819642738891e0",
                    "9.76284367953836866133894756472541395734e-1",
                    "3.69932155343422362573146811195224195135e-1",
                    "8.97593541520549770519034085640975455763e-2",
                    "1.45862809001322359249894968573830094537e-2",
                    "1.61348135835522976885804369721316193713e-3",
                    "1.21069949470458047530981551232427019037e-4",
                    "6.03132437580490629136144285669590192597e-6",
                    "1.91030348024641585284338958059030520141e-7",
                    "3.56320479309161046934628280237629402373e-9",
                    "3.39524198476052364627683067034422502163e-11",
                    "1.18666081063885228839052386515073873844e-13",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_8_16 = new(
                new ReadOnlyCollection<Float128>([
                    "6.60044810497290557552736366450372523266e-3",
                    "4.27034183360438185616541260923634443241e-3",
                    "1.19813403884333707962156711479716066536e-3",
                    "1.91346554854771687970018076643044998737e-4",
                    "1.91975837766081548424458764226669789039e-5",
                    "1.26031304514411902758114277797443618334e-6",
                    "5.47127194811140370123712253347211626753e-8",
                    "1.55248861254135821097921903190564312000e-9",
                    "2.78340847719683652633864722047250151066e-11",
                    "2.95888612422041337572422846394029849086e-13",
                    "1.66363005792960308636467394552324255493e-15",
                    "3.93244800648299424751906591077496534948e-18",
                    "1.95046217952146113063614290717113024410e-21",
                    "-4.46784746963816915795587433372284530785e-25",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "8.16012189991825507132967712656930682478e-1",
                    "2.95202772611563835130347051925062280272e-1",
                    "6.23801477561401113332870463345197159418e-2",
                    "8.54022665579711946784722766000062263305e-3",
                    "7.94266182294627770206082679848878391116e-4",
                    "5.11782839184878848480753630961211685630e-5",
                    "2.28827067686094594197542725283923947812e-6",
                    "7.00220719177374237332018587370837457299e-8",
                    "1.42250513143925626748132661121749401409e-9",
                    "1.82007216963767723991309138907689681422e-11",
                    "1.34214834652884406013489167210936679359e-13",
                    "4.85519293212465087373898447546710143008e-16",
                    "5.96728437809303144188312623363453475831e-19",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_16_32 = new(
                new ReadOnlyCollection<Float128>([
                    "2.54339461777955741686401041938275102207e-3",
                    "8.17747085249877439037826121862689145081e-4",
                    "1.14104576580586095462211756659036062930e-4",
                    "9.06903778663262313120049231822412184382e-6",
                    "4.53115958954246158081703822428768781010e-7",
                    "1.48225007017630665357941682179157662142e-8",
                    "3.20810829523286181556951002345409843125e-10",
                    "4.54070972719909957155251432996372246019e-12",
                    "4.06258623970363729581390609798632080752e-14",
                    "2.15603641527498625694677136504611545743e-16",
                    "6.05376970060354261667000502105893106009e-19",
                    "7.14727542705613448694396750352455931731e-22",
                    "1.76883960167449461476228984331517762578e-25",
                    "-2.03558202009465610972808653993060437679e-29",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "4.08809672969012756295937194823378109391e-1",
                    "7.41148083436617376855422685448827300528e-2",
                    "7.85101541143091590863368934606849033688e-3",
                    "5.38984899982960112626157576750593711628e-4",
                    "2.51437845497783812562009857096371643785e-5",
                    "8.12891276596072815764119699444334380521e-7",
                    "1.82412500887161687329929693518498698716e-8",
                    "2.80215715026891688444965605768621763721e-10",
                    "2.85838684678780184082810752634454259831e-12",
                    "1.83675729736846176693608812315852523556e-14",
                    "6.80347165008408134158968403924819637224e-17",
                    "1.23639219622240634094606955067799349447e-19",
                    "7.63446235885036169537726818244420509024e-23",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_32_64 = new(
                new ReadOnlyCollection<Float128>([
                    "9.55085695067883584460317653567009454037e-4",
                    "1.52919532248638251721278667010429548877e-4",
                    "1.06266842295477991789450356745903177571e-5",
                    "4.20671609948319334255323512011575892813e-7",
                    "1.04692714549374449244320605137676408001e-8",
                    "1.70605481454469287545965803970738264158e-10",
                    "1.83960996572005209177458712170004097587e-12",
                    "1.29732261733491885750067029092181853751e-14",
                    "5.78385693918239619309147428897790440735e-17",
                    "1.52969197316398995616879018998891661712e-19",
                    "2.14063120299947677255281707434419044806e-22",
                    "1.25957675329657493245893497219459256248e-25",
                    "1.55238112862817593053765898004447484717e-29",
                    "-8.93970406521541790658675747195982964585e-34",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "2.04722757068068234153968603374387493579e-1",
                    "1.85854131835804458353300285777969427206e-2",
                    "9.85809281481040288085436275150792074968e-4",
                    "3.38860750164285700051427698379841626305e-5",
                    "7.91463283601681120487987016215594255423e-7",
                    "1.28104952818420195583669572450494959042e-8",
                    "1.43912720109615655035554724090181888734e-10",
                    "1.10668954229813492117417896681856998595e-12",
                    "5.65093571330749369067212003571435698558e-15",
                    "1.81758227619561958470583781325371429458e-17",
                    "3.36970757752002915423191164330598255294e-20",
                    "3.06487673393164724939989217811068656932e-23",
                    "9.47121057452822097779067717258050172115e-27",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_limit = new(
                new ReadOnlyCollection<Float128>([
                    "1.99471140200716338969973029967190934238e-1",
                    "3.82846732476244747063962056024672844211e-2",
                    "-3.69724475658159099827638225237895868258e-3",
                    "2.21259630917863228526439367416146293173e-3",
                    "3.13469812721679130825429547254346177005e-5",
                    "-2.73237434182338329541631611908947123606e-5",
                    "4.72986150007117100707304201395140411630e-6",
                    "-2.53567129749337040254350979652515879881e-7",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "9.89815449697874475254942178935516387239e-1",
                    "5.21223228867921988134838870379132038419e-1",
                    "1.79514417558927397512722128659468888701e-1",
                    "4.43331254539687594239741585764730095049e-2",
                    "7.99078779616201786316256750758748178864e-3",
                    "1.04590833634768023225748107112347131311e-3",
                    "9.17497990182339853998751740288392648984e-5",
                    "4.53420609011698705803549938558385779137e-6",
                ])
            );

            public static Float128 Value(Float128 x) {
                x = Float128.Abs(x);

                Float128 y;
                if (x <= 0.0625d) {
                    Debug.WriteLine("pade minimum segment passed");

                    y = ApproxUtil.Pade(x, pade_plus_0_0p0625);
                }
                else if (x <= 0.125d) {
                    y = ApproxUtil.Pade(x - 0.0625, pade_plus_0p0625_0p125);
                }
                else if (x <= 0.25d) {
                    y = ApproxUtil.Pade(x - 0.125d, pade_plus_0p125_0p25);
                }
                else if (x <= 0.5d) {
                    y = ApproxUtil.Pade(x - 0.25d, pade_plus_0p25_0p5);
                }
                else if (x <= 1d) {
                    y = ApproxUtil.Pade(x - 0.5d, pade_plus_0p5_1);
                }
                else if (x <= 2d) {
                    y = ApproxUtil.Pade(x - 1d, pade_plus_1_2);
                }
                else if (x <= 4d) {
                    y = ApproxUtil.Pade(x - 2d, pade_plus_2_4);
                }
                else if (x <= 8d) {
                    y = ApproxUtil.Pade(x - 4d, pade_plus_4_8);
                }
                else if (x <= 16d) {
                    y = ApproxUtil.Pade(x - 8d, pade_plus_8_16);
                }
                else if (x <= 32d) {
                    y = ApproxUtil.Pade(x - 16d, pade_plus_16_32);
                }
                else if (x <= 64d) {
                    y = ApproxUtil.Pade(x - 32d, pade_plus_32_64);
                }
                else {
                    Float128 v = Float128.Sqrt(x);
                    Float128 u = 1d / v;

                    y = ApproxUtil.Pade(u, pade_plus_limit) * (u * u * u);
                }

                return y;
            }
        }

        private static class CDFPade {
            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_0_0p125 = new(
                new ReadOnlyCollection<Float128>([
                    "5.0e-1",
                    "5.25520067710293108163697513129883130648e2",
                    "2.70866020657515874782126804139443323023e5",
                    "9.00865235319309486225795793030882782077e7",
                    "2.15226363537737769449645357346965170790e10",
                    "3.90371247243851280277289046301838071764e12",
                    "5.55124590509169425751300134399513503679e14",
                    "6.31282020412787511681760982839078664474e16",
                    "5.81134278666896523873256421982740565131e18",
                    "4.36154530125229747305141034242362609073e20",
                    "2.67793867640429875837167908549938345465e22",
                    "1.34584264816825205490037614178084070903e24",
                    "5.52622279567059369718208827282730379468e25",
                    "1.84678324511679577282571711018484545185e27",
                    "4.99412564257799793932936828924325638617e28",
                    "1.08467105431111959283045453636520222779e30",
                    "1.87466808926544728702827204697734995611e31",
                    "2.55020252231174414164534905191762212055e32",
                    "2.69582736077420504345389671165954321163e33",
                    "2.18203860972249826626461130638196586188e34",
                    "1.32955733788770318392204091471121129386e35",
                    "5.97972270315674052071792562126668438695e35",
                    "1.93941537398987201071027348577636994465e36",
                    "4.40818708062034138095495206258366082481e36",
                    "6.76833406751769751643745383413977973530e36",
                    "6.67873467711368838525239991688791162617e36",
                    "3.94179310584115437584091984619858795365e36",
                    "1.24348215908456320362232906012152922949e36",
                    "1.71625432346533320597285660433110657670e35",
                    "6.54662474187354179772157464533408058525e33",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "1.05231337496532137901354609636674085703e3",
                    "5.43071888317491317900094470796567113997e5",
                    "1.80864482202910830302921131771345102044e8",
                    "4.32755297215862998181755216820621285536e10",
                    "7.86251123527611073428156549377791985741e12",
                    "1.12025543961949466786297141758805461421e15",
                    "1.27681657695574252637426145112570596483e17",
                    "1.17850553865715973904162289375819555884e19",
                    "8.87285897504702686250962844939736867339e20",
                    "5.46852796231948446334549476317560711795e22",
                    "2.76101689878844725930808096548998198853e24",
                    "1.14017776727845251567032313915953239178e26",
                    "3.83738954971390158348334918235614003163e27",
                    "1.04701345216121451992682705965658316871e29",
                    "2.29994190638467725374533751141434904865e30",
                    "4.03334024242845994501493644478442360593e31",
                    "5.59094378123268840693978620156028975277e32",
                    "6.05630254163426327113368743426054256780e33",
                    "5.06008195534030444387061989883493342898e34",
                    "3.21262490304347036689874956206774563906e35",
                    "1.52353024633841796119920505314785365242e36",
                    "5.28839143293381125956284415313626962263e36",
                    "1.31074057704096457802547386358094338369e37",
                    "2.24762412200364040971704861346921094354e37",
                    "2.55663903116458425420509083471048286114e37",
                    "1.81839283802391753865642022579846918253e37",
                    "7.40026559327708207943879092058654410696e36",
                    "1.48767474646810049293505781106444169229e36",
                    "1.10591353097667671736865938428051885499e35",
                    "1.26980708896893794012677171239610721832e33",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_0p125_0p25 = new(
                new ReadOnlyCollection<Float128>([
                    "4.31887921568009055676985827521151969069e-1",
                    "2.62791448964529380666250180886203090183e1",
                    "6.18238045199893937316918299064825702894e2",
                    "7.77274519306540522227493503092956314136e3",
                    "5.89424638466340765479970877448972418958e4",
                    "2.84027004420207996285174223581748706097e5",
                    "8.84633134142285937075423713704784530853e5",
                    "1.76780579189423063605715733542379494552e6",
                    "2.19812409802969581112716039533798357401e6",
                    "1.60039008588877024309600768114757310858e6",
                    "6.10268260529501421009222937882726290612e5",
                    "9.72169594688819848498039471657587836720e4",
                    "3.27181379647139697258984772894869505788e3",
                    "-4.73617450590346508706222885401965820190e1",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "6.18558935411552146390814444666395959919e1",
                    "1.49210559503096368944407109881023223654e3",
                    "1.93959323596111340518285858313038058302e4",
                    "1.53590607436758691037825792660167970938e5",
                    "7.82700985983018132572589829602100319330e5",
                    "2.62137033935442506086127262036686905276e6",
                    "5.76014299715348555304267927238963139228e6",
                    "8.12336796972134088340556958396544477713e6",
                    "7.01952132024838508233050167059872220508e6",
                    "3.41846547214877387780832317250797043384e6",
                    "8.02083431572388097955901208994308271581e5",
                    "6.30401057171447074343957754855656724141e4",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_0p25_0p5 = new(
                new ReadOnlyCollection<Float128>([
                    "3.87119665000174806422420129219814467874e-1",
                    "7.60769554551148293079169764245570645155e0",
                    "6.49181979810834706538329284478129952168e1",
                    "3.15722765491675871778645250624425739489e2",
                    "9.65973147084701923411221710174830072860e2",
                    "1.93709338011482232037110656459951914303e3",
                    "2.57393131299425403017769538642434714791e3",
                    "2.24110491141294379107651487490031694257e3",
                    "1.23670394514211681515965192338544032862e3",
                    "4.06141024932329394052395469123628405389e2",
                    "7.08599362073145455095790192415468286304e1",
                    "5.22746783794652085925801188098270888502e0",
                    "8.19652234873414609727168969049557770989e-2",
                    "-5.73529976407853894192156335785920329181e-4",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "2.04157569499592889296640733909653747983e1",
                    "1.82248883130787159161541119440215325308e2",
                    "9.35191216924911901198168794737654512677e2",
                    "3.05099314677808235578577204150229855903e3",
                    "6.61081069236463123032873733048661305746e3",
                    "9.65340645555368229718826047069323437201e3",
                    "9.44526681322128674428653420882660351679e3",
                    "6.03963804195353853550682049993122898950e3",
                    "2.40399236835577953127465726826981753422e3",
                    "5.46764755170079991793106428011388637748e2",
                    "6.06384106042490712972156545051459068443e1",
                    "2.27614406724572981099586665536543423891e0",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_0p5_1 = new(
                new ReadOnlyCollection<Float128>([
                    "3.31309550000758082761278726632760756847e-1",
                    "4.07242222531117199094690544171275415854e0",
                    "2.18286763141875580859241637334381199648e1",
                    "6.72102024869298528501604761974348686708e1",
                    "1.31748399999514540052066169132819656757e2",
                    "1.72168003284748405703923567644025252608e2",
                    "1.52648991506052496046447777354251378257e2",
                    "9.16777263528764704804758173026143295383e1",
                    "3.66044453196259367950849328889468385159e1",
                    "9.35095952392355288307377427145581700484e0",
                    "1.43011308494452327007589069222668324337e0",
                    "1.16582092138863383294685790744721021189e-1",
                    "4.02261914949200575965813000131964695720e-3",
                    "2.93943913630044161720796150617166047233e-5",
                    "-9.76395009419307902351328300308365369814e-8",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "1.28073115520716780203055949058270715651e1",
                    "7.20245752585870752942356137496087189194e1",
                    "2.34548337034735803039553186623067144497e2",
                    "4.90925817267776213429724248532378895039e2",
                    "6.92883822651628140083115301005227577059e2",
                    "6.72868136219107985834601503784789993218e2",
                    "4.50498744791568911029110559017896701095e2",
                    "2.05178276667813671578581259848923964311e2",
                    "6.16880263792490095344135867620645018480e1",
                    "1.16199396397514668672304602774610890666e1",
                    "1.25543193822942088303609988399416145281e0",
                    "6.62522294286034117189844614005500278984e-2",
                    "1.18342889744790118595835138444372660676e-3",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_1_2 = new(
                new ReadOnlyCollection<Float128>([
                    "2.71280312689343266367958859259591541365e-1",
                    "1.49628636612698702680819948707479820292e0",
                    "3.61090930375686902075245639803646265081e0",
                    "5.01191924051756106307211298794294657688e0",
                    "4.42496510376427957390465373165464672088e0",
                    "2.59577769624139820954046058289100998534e0",
                    "1.02664809521258420718170586857797408674e0",
                    "2.72258711278476951299824066502536249701e-1",
                    "4.72578941800687566921553416498339481887e-2",
                    "5.12553368488232553360765667155702324159e-3",
                    "3.20749770911901442251726681861858323649e-4",
                    "1.00621121212654384864006297569770703900e-5",
                    "1.18976033102817074104109472578202752346e-7",
                    "2.22093548539863254922531707899658394458e-10",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "5.83305694892673455436552817409325835774e0",
                    "1.49922543669955056754932640312490112609e1",
                    "2.23488972536322019584648241457582608908e1",
                    "2.14051527527038669918848981363974859889e1",
                    "1.37891280136777182304388426277537358346e1",
                    "6.08058775103864815769223385606687612117e0",
                    "1.83305488980337433132332401784292281716e0",
                    "3.71072208215804671719811563659227630554e-1",
                    "4.86332040813989094594982937011005305263e-2",
                    "3.87698178237970337664105782546771501188e-3",
                    "1.69113555019737313680732855691540088318e-4",
                    "3.31888539972217875242352157306613891243e-6",
                    "1.85633766164682554126992822326956560433e-8",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_2_4 = new(
                new ReadOnlyCollection<Float128>([
                    "2.13928162275383718405630406427822960090e-1",
                    "5.90742307267701162395764574873947997211e-1",
                    "7.13821826367941514387521090205756466068e-1",
                    "4.96186879146063565484800486550739025293e-1",
                    "2.19438785955706463753454881511977831603e-1",
                    "6.44969124820016994689518539612465708536e-2",
                    "1.27841835070651018079759230944461773079e-2",
                    "1.69952429132675045239242077293594666305e-3",
                    "1.47919853099168659881487026035933933068e-4",
                    "8.04644774117864306055402364094681541437e-6",
                    "2.52604718870921084048756263996119841957e-7",
                    "3.97610950633031564892821158058978809537e-9",
                    "2.35934159016861180185992558083703785765e-11",
                    "2.21044098237798939057079316997065892072e-14",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "2.94437702178976797218081686254875998984e0",
                    "3.82068837586514484653828718675654460991e0",
                    "2.87606058269189306593797764456467061128e0",
                    "1.39130528408903116343256483948950693356e0",
                    "4.52792074489091396425713962375223436022e-1",
                    "1.00892233011840867583848470677898363716e-1",
                    "1.53717105060592851173320646706141911461e-2",
                    "1.57293857675930200001382624769341451561e-3",
                    "1.04219251796696135508847408131139677925e-4",
                    "4.20053006131133304932740325113068767057e-6",
                    "9.26384707028090985155079342718673255493e-8",
                    "9.19146442700994823924806249608315505708e-10",
                    "2.59879298772002950043508762057850408213e-12",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_4_8 = new(
                new ReadOnlyCollection<Float128>([
                    "1.63772802979087199762340235165979751298e-1",
                    "2.31941534705372320785274994658709390116e-1",
                    "1.43643960022585762678456016437621064500e-1",
                    "5.11415302325466272779041471612529728187e-2",
                    "1.15767742459744253874067896740220951622e-2",
                    "1.74049309186016489825053763513176160256e-3",
                    "1.76349898574685150849080543168157785281e-4",
                    "1.19757202370729036627932327405149840205e-5",
                    "5.32067727965321839898287320520750897894e-7",
                    "1.47636340015260789807543414080472136575e-8",
                    "2.36236727340568181129875213546468908164e-10",
                    "1.89379573960280486883733996547662506245e-12",
                    "5.71832232038263988173042637335112603365e-15",
                    "2.72380245500539326441037770757072641975e-18",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "1.51702400281458104713682413542736419584e0",
                    "1.01375164846907815766683647295932603968e0",
                    "3.92796007869834847612192314006582598557e-1",
                    "9.77580441164023725582659445614058463183e-2",
                    "1.63592331843149724480258804892989851727e-2",
                    "1.87334158717610115008450674967492650941e-3",
                    "1.46596056941432875244263245821845070102e-4",
                    "7.69980051560936361597177347949112822752e-6",
                    "2.61690034211585843423761830218320365457e-7",
                    "5.40619773800285766355596852314940341504e-9",
                    "6.10624533319804091814643828283820958419e-11",
                    "3.10009654621246392691126133176423833259e-13",
                    "4.48070591106986983088640496621926852293e-16",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_8_16 = new(
                new ReadOnlyCollection<Float128>([
                    "1.22610122564874286614786819620499101143e-1",
                    "8.30352481858382230273216195795534959290e-2",
                    "2.45933050053542949214164590814846222512e-2",
                    "4.18776888646200567321599584635465632591e-3",
                    "4.53421996228923143480455729204878676265e-4",
                    "3.26075686557831306993734433164305349875e-5",
                    "1.58045762501721375879877727645933749122e-6",
                    "5.13469629033419341069106781092024950086e-8",
                    "1.09157226556088521407323375433512662525e-9",
                    "1.44961350323527660188267669752380722085e-11",
                    "1.11052101325523147964890915835024505324e-13",
                    "4.26421404354976214191891992583151033361e-16",
                    "6.17133505681224996657291059553060754343e-19",
                    "1.41010917905686427164414364663355769988e-22",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "7.31062773739451672808456319166347015167e-1",
                    "2.35386721434011881226168110614121649232e-1",
                    "4.39357338312443465616015226804775178232e-2",
                    "5.26630144036271792027494677957363535353e-3",
                    "4.24340476859846183414651435036807677467e-4",
                    "2.33917136421389571662908749253850939876e-5",
                    "8.80972141456523767244381195690041498939e-7",
                    "2.22653625120465488656616983786525028119e-8",
                    "3.64072452032620505897896978124863889812e-10",
                    "3.61842001579321492488462230987972104386e-12",
                    "1.96631619425501661980194304605724632777e-14",
                    "4.80392324086028812772385536034034039168e-17",
                    "3.34254502871215949266781048808984963366e-20",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_16_32 = new(
                new ReadOnlyCollection<Float128>([
                    "9.03056141356415128156562790092782153630e-2",
                    "3.15331583242023443256381237551843296356e-2",
                    "4.81847913073640285776566199343276995613e-3",
                    "4.23578443960486030170636772457627141406e-4",
                    "2.36906354316016270165240908809929957836e-5",
                    "8.80584421020238085239890207672296651219e-7",
                    "2.20726437845755296397071540583729544203e-8",
                    "3.71042563703818585243207722641746283288e-10",
                    "4.08307373360265947158569900625482137206e-12",
                    "2.80776566500233755365518221977875432763e-14",
                    "1.11405351639704510305055492207286172753e-16",
                    "2.21575609293568296049921888011966327905e-19",
                    "1.66081982641748223969990279975752576675e-22",
                    "1.96483118060215455299182487430511998831e-26",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "3.77347004038951368607085827825968614455e-1",
                    "6.27559305780716801070924630708599448466e-2",
                    "6.05452382624230160738008550961679711827e-3",
                    "3.75369667590360521677018734348769796476e-4",
                    "1.56551290985905942229892419848093494661e-5",
                    "4.46972102361871185271727958608184616388e-7",
                    "8.72423917010499649257775199140781647069e-9",
                    "1.14337306905269302583746182007852069459e-10",
                    "9.69949885309711859563395555285232232606e-13",
                    "5.00318719634300754237920041312234711548e-15",
                    "1.41139664927184402637020651515172315287e-17",
                    "1.79013190225240505774959477465594797961e-20",
                    "6.46536966503325413797061462062918707370e-24",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_32_64 = new(
                new ReadOnlyCollection<Float128>([
                    "6.57333571766941514095434647381791040479e-2",
                    "1.15416685251021339933358981066948923001e-2",
                    "8.86806753164417557035166075399588122481e-4",
                    "3.91972616817770660098405128729991574724e-5",
                    "1.10225768760715861978198010761036882002e-6",
                    "2.05986998674039047865566990469266534338e-8",
                    "2.59572646670205456333051888086612875871e-10",
                    "2.19347294198055585461131949159508730257e-12",
                    "1.21328285448498841418774425071549974153e-14",
                    "4.19331596847283822557042655221763459728e-17",
                    "8.36128017817576942059191451016251062072e-20",
                    "8.35600223942735523925477855247725326228e-23",
                    "3.14658948592500290756690769268766876322e-26",
                    "1.86984591055448991335081550609451649866e-30",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "1.90112824856612652807095815199496602262e-1",
                    "1.59291524937386142936420775839969648652e-2",
                    "7.74245361925275011235694006013677228467e-4",
                    "2.41828589449615478387532599798645159282e-5",
                    "5.08088176420557205743676774127863572768e-7",
                    "7.30760429417424419297000535744450830697e-9",
                    "7.18464910867914234357511605329900284981e-11",
                    "4.74255540513281299503596269087176674333e-13",
                    "2.02616028440371294233330747672966435921e-15",
                    "5.26276597941744408946918920573146445795e-18",
                    "7.47463109867603732992337779860914933775e-21",
                    "4.77217411888267832243050973915295217582e-24",
                    "8.67397425207383164084527830512920206074e-28",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_limit = new(
                new ReadOnlyCollection<Float128>([
                    "3.98942280401432677939946059934381868476e-1",
                    "1.33908701314796522684603310107061150444e-1",
                    "2.92120397142832495974006972404741124398e-2",
                    "6.15463147603421962834297353867930971657e-3",
                    "4.44488751006069172847577645328482300099e-4",
                    "1.44057582804743599116332797864164802887e-5",
                    "4.02968018188491417839349438941039867033e-6",
                    "-4.75092244933846337077999183310087492887e-7",
                    "2.35099582728548602389917143511323566818e-8",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "7.34601617336219074065534356705298927390e-1",
                    "2.82954035780824611941899463895040327299e-1",
                    "6.70929001162671283123255408612494541378e-2",
                    "1.05508596604210030533747793197422815105e-2",
                    "1.02913299057943756875992272236063124608e-3",
                    "5.37824426836648736125759177846682556245e-5",
                ])
            );

            public static Float128 Value(Float128 x) {
                if (Float128.IsNegative(x)) {
                    return 1d - Value(-x);
                }

                Float128 y;
                if (x <= 0.125d) {
                    Debug.WriteLine("pade minimum segment passed");

                    y = ApproxUtil.Pade(x, pade_plus_0_0p125);
                }
                else if (x <= 0.25d) {
                    y = ApproxUtil.Pade(x - 0.125d, pade_plus_0p125_0p25);
                }
                else if (x <= 0.5d) {
                    y = ApproxUtil.Pade(x - 0.25d, pade_plus_0p25_0p5);
                }
                else if (x <= 1d) {
                    y = ApproxUtil.Pade(x - 0.5d, pade_plus_0p5_1);
                }
                else if (x <= 2d) {
                    y = ApproxUtil.Pade(x - 1d, pade_plus_1_2);
                }
                else if (x <= 4d) {
                    y = ApproxUtil.Pade(x - 2d, pade_plus_2_4);
                }
                else if (x <= 8d) {
                    y = ApproxUtil.Pade(x - 4d, pade_plus_4_8);
                }
                else if (x <= 16d) {
                    y = ApproxUtil.Pade(x - 8d, pade_plus_8_16);
                }
                else if (x <= 32d) {
                    y = ApproxUtil.Pade(x - 16d, pade_plus_16_32);
                }
                else if (x <= 64d) {
                    y = ApproxUtil.Pade(x - 32d, pade_plus_32_64);
                }
                else {
                    Float128 v = Float128.Sqrt(x);
                    Float128 u = 1d / v;

                    y = ApproxUtil.Pade(u, pade_plus_limit) * u;
                }

                return y;
            }
        }

        private static class QuantilePade {
            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_expm1_1p125 = new(
                new ReadOnlyCollection<Float128>([
                    0,
                    "1.36099130643975133156293056139850872219e-1",
                    "9.03940482189350763127508703926866548690e1",
                    "3.00518276893354880480781640750482315271e4",
                    "6.55844903094077096941027360107304259099e6",
                    "1.04507684135310729583474324660276395831e9",
                    "1.28519957085041757616278379578781441623e11",
                    "1.26054173986187219679917530171252145632e13",
                    "1.00693075272502479915569708465960917906e15",
                    "6.64153695410984136395853200311209462775e16",
                    "3.64993034609287363745840801813540992383e18",
                    "1.68080300629977787949474098413155901197e20",
                    "6.50632142671665246974634799849090331338e21",
                    "2.11943753054362349397013211631038480307e23",
                    "5.80601829873419334580289886671478701625e24",
                    "1.33441650581633426542372642262736818512e26",
                    "2.56279427934163518272441555879970370340e27",
                    "4.08899113985387092689705022477814364717e28",
                    "5.37750989391907347952902900750138805007e29",
                    "5.76961267256299304213687639380275530721e30",
                    "4.98417586455955659885944915688130612888e31",
                    "3.40932923796679251232655132670811114351e32",
                    "1.80810239916688876216017180714744912573e33",
                    "7.23907429566810200929293428832485038147e33",
                    "2.11441754640405256305951569489818422227e34",
                    "4.30534222360394829628175800718529342304e34",
                    "5.73301799323855143458670230536670073483e34",
                    "4.53142592196246595846485130434777396548e34",
                    "1.81719621726393542967303806360105998384e34",
                    "3.00188544550531824809437206713326495544e33",
                    "2.62706943144847786115732327787879709587e32",
                    "2.32129438774563059735783287456769609571e31",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "6.65910866673514847742559406762379054364e2",
                    "2.21954860438789969160116317316418373146e5",
                    "4.85684385746348850219351196129081986508e7",
                    "7.76131116920014625994371306210585646224e9",
                    "9.57402411617965582839975369786525269977e11",
                    "9.42213951996062253608905591667405322835e13",
                    "7.55477693883842522631954327528060778834e15",
                    "5.00397907346473927493255003955380711046e17",
                    "2.76305959503723486331556274939198109922e19",
                    "1.27926540483498824808520492399128682366e21",
                    "4.98253913105291675445666919447864520248e22",
                    "1.63457445658532249936389003141915626894e24",
                    "4.51446616633910582673057455450707805902e25",
                    "1.04744823698010333311911891992022528040e27",
                    "2.03400927415310540137351756981742318263e28",
                    "3.28761940359662123632247441327784689568e29",
                    "4.39016138777648624292953560568071708327e30",
                    "4.79639567867465767764785448609833337532e31",
                    "4.23406781975678544311073661662680006588e32",
                    "2.97261483656310352862554580475760827374e33",
                    "1.62715040832592600542933595577003951697e34",
                    "6.77359945057399130202830211722221279906e34",
                    "2.07842295432910751940058270741081867701e35",
                    "4.51739306780247334064265249344359460675e35",
                    "6.60574331076505049588401700048488577194e35",
                    "6.08286808700840316336961663635580879141e35",
                    "3.27661033115008662284071342245200272702e35",
                    "1.00465576791024249023365007797010262700e35",
                    "1.83311248273885136105510175099322638440e34",
                    "1.96635220211386288597285960837372073054e33",
                    "1.23849744128418288892902205619933047730e32",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_expm1p125_1p25 = new(
                new ReadOnlyCollection<Float128>([
                    "1.46698650748920243663487731226111319705e-2",
                    "6.39021286045890143123252180276484388346e-1",
                    "1.21933242816562043224009451007344301143e1",
                    "1.33741547463966207206741888477702151242e2",
                    "9.29556944160837955334643715180923663741e2",
                    "4.25261081330476435844217173674285740857e3",
                    "1.28690563577245995896389783271544510833e4",
                    "2.51764495004238264050843085122188741180e4",
                    "3.00501773552098137637598813101153206656e4",
                    "1.93991776883375928647775429233323885440e4",
                    "5.13059418708769178567954713937745050279e3",
                    "2.41565791250614170744069436181282300453e2",
                    "3.35838723365672196069179944509778281549e1",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "3.63888803456697300467924455320638435538e1",
                    "5.74785179836182339383932806919167693991e2",
                    "5.15133301804008879476562749311747788645e3",
                    "2.87361675398393057971764841741518474061e4",
                    "1.02992617475892211368309739891693879676e5",
                    "2.36356854400440662641546588001882412251e5",
                    "3.35807552915245783626759227539698719908e5",
                    "2.75959389290929178190646034566377062463e5",
                    "1.18514088996371641206828142820042918681e5",
                    "2.54881978220293930450469794941944831047e4",
                    "2.83958740186543542804045767758191509433e3",
                    "1.26637084978098507405883170227585648985e2",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_expm1p25_1p5 = new(
                new ReadOnlyCollection<Float128>([
                    "2.69627866689346442965083437425920959525e-2",
                    "6.28948812330446670380449765578224539665e-1",
                    "6.38832694133021352110245148952631526683e0",
                    "3.70206624753427831733487031852769976576e1",
                    "1.34677850226082773550206949299306677736e2",
                    "3.18657422004942861459539366963056149110e2",
                    "4.90933843076824719761937043667767333536e2",
                    "4.78597771586582252472927601403235921029e2",
                    "2.76489020985978559079198751910122765603e2",
                    "8.37662018494780327201390375334403954354e1",
                    "1.11303058491765900888068268844399186476e1",
                    "8.38147649159947518976483710606042789880e-1",
                    "7.81260575060831053615857196033574207714e-2",
                    "-1.26783311530618626413866321968979725353e-3",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "1.98941943311823528497840052715295329781e1",
                    "1.70142252619301982454969690308614487433e2",
                    "8.17472255695869018956165466705137979540e2",
                    "2.42016169942136311355803413981032780219e3",
                    "4.55874385736597452997483327962434131932e3",
                    "5.45782883079400958761816030672202996788e3",
                    "4.05272877129840019671123017296056938361e3",
                    "1.79833037593794381103412381177370862105e3",
                    "4.67388248713896792948592889733513376054e2",
                    "7.19952164110429183557842014635391021832e1",
                    "6.43813483967503071358907030110791934870e0",
                    "3.21327682641358836049127780506729428797e-1",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_expm1p5_2 = new(
                new ReadOnlyCollection<Float128>([
                    "4.79518653373241051262822702930040975338e-2",
                    "5.62230291299220868262265687829866364204e-1",
                    "2.87315544620612697712513318458226575394e0",
                    "8.38993950875334507399211313740958438201e0",
                    "1.54257654902026056547861805085572437922e1",
                    "1.85673656862223617197701693270067722169e1",
                    "1.47842193222521213922734312546590337064e1",
                    "7.76640627287007744941009407221495229316e0",
                    "2.71884893887802925773271837595143776207e0",
                    "6.87432154629995817972739015224205530101e-1",
                    "1.44664933176248007092868241686074743562e-1",
                    "2.32094739938150047092982705610586287965e-2",
                    "2.18537678581395571564129512698022192316e-3",
                    "1.99365265557355974918712592061740510276e-4",
                    "7.66467016868206844419002547523627548705e-6",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "1.01315080955831561204744043759079263546e1",
                    "4.43409077070585581955481063438385546913e1",
                    "1.09863540097812452102765922256432103612e2",
                    "1.69971336507400724019217277303598318934e2",
                    "1.71444880426858110981683485927452024652e2",
                    "1.15252748520663939799185721687082682973e2",
                    "5.28399989835264172624148638350889215004e1",
                    "1.73464700365199500083227290575797895127e1",
                    "4.40421770918884020099427978511354197438e0",
                    "8.97023025282119988988976542004620759235e-1",
                    "1.38774609088015115009880504176630591783e-1",
                    "1.52748138528630655371589047000668876440e-2",
                    "1.13088455793478303045390386135591069087e-3",
                    "5.18220605549460262119565543089703387122e-5",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_expm2_4 = new(
                new ReadOnlyCollection<Float128>([
                    "8.02395484493329839255216366819344305871e-2",
                    "5.02703992140456336967688958960484716694e-1",
                    "1.38779662796374026809611637926067177436e0",
                    "2.22326903547451397450399124548020897393e0",
                    "2.29321119874906326000117036864856138032e0",
                    "1.60045794013093831332658415095234082115e0",
                    "7.75863216252160126657107771372004587438e-1",
                    "2.65658718311497180532644775193008407069e-1",
                    "6.53225259384404343896446164609240157391e-2",
                    "1.17876243295156782920260122855798305258e-2",
                    "1.59647007234516896762020830535717539733e-3",
                    "1.64519789656979327339865975091579252352e-4",
                    "1.29566724776730544346201080459027524931e-5",
                    "7.40979492647851412567441418477263395917e-7",
                    "2.78894057948338305679452471174923939381e-8",
                    "7.97064244496171921075006182915678263370e-10",
                    "1.13496588267213644899739513941375650458e-13",
                    "3.75224691413667093006312591320754720811e-14",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "5.59000688626663121310675150262772434285e0",
                    "1.37518060227321498297232252379976917550e1",
                    "1.96559443266702775026538144474892076437e1",
                    "1.81865210018244220041408788510705356696e1",
                    "1.15188291931842064325756652570456168425e1",
                    "5.16909307081950035111952362482113369939e0",
                    "1.68454509269150307761046136063890222011e0",
                    "4.06391236761753712424925832120306727169e-1",
                    "7.35744804731044427608283991933125506859e-2",
                    "1.00655928177646208520006978937806043639e-2",
                    "1.04093230988242553633939757013466501271e-3",
                    "8.07921031269974885975846184199640060403e-5",
                    "4.61356596082773699708092475561216104426e-6",
                    "1.83968520269928804453766899533464507543e-7",
                    "4.44620973323561344735660659502096499899e-9",
                    "1.84398925760354259350870730551452956164e-11",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_expm4_8 = new(
                new ReadOnlyCollection<Float128>([
                    "1.39293493266195566603513288406748830312e-1",
                    "2.75724665658983779947977436518056682748e-1",
                    "2.42437549740894393207094008058345312893e-1",
                    "1.26189619865771499663660627120168211026e-1",
                    "4.38952430871711360962228087792821341859e-2",
                    "1.09604487371653920602809626594722822237e-2",
                    "2.06215021409396534038209460967790566899e-3",
                    "3.02245531075243838209245241246011523536e-4",
                    "3.52822482024384335373072062232322682354e-5",
                    "3.32527687997718638700761890588399465467e-6",
                    "2.54799997015944073019842889902521208940e-7",
                    "1.59368565314052950335981455903474908073e-8",
                    "8.09459594346367728583560281313278117879e-10",
                    "3.30296867679720593932307487485758431355e-11",
                    "1.04594079707862644415224596859620253913e-12",
                    "2.40274507498190913768918372242285652373e-14",
                    "3.48644117815971872777609922455371868747e-16",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "1.88079839671202113888025645668230104601e0",
                    "1.58898753182105924446845274197682915131e0",
                    "8.05418719178760837974322764299800701708e-1",
                    "2.76439568495464423890950166804368135632e-1",
                    "6.87661284201828717694596419805804620767e-2",
                    "1.29462021166220769918154388930589492957e-2",
                    "1.89960014717788045459266868996575581278e-3",
                    "2.21759236630028632465777310665839652757e-4",
                    "2.08884467282860764261728614542418632608e-5",
                    "1.60098870889198704716300891829788260654e-6",
                    "1.00120123451682223443624210304146589040e-7",
                    "5.08868117923724451329261971335574401646e-9",
                    "2.07346130275947166224129347124306950150e-10",
                    "6.57848230665832873347797099944091265220e-12",
                    "1.50841502849442327828534131901583916707e-13",
                    "2.19165038770000448560339443014882434202e-15",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_expm8_16 = new(
                new ReadOnlyCollection<Float128>([
                    "1.57911660613037766795694241662819364797e-1",
                    "1.28799302413396670477035614399187456630e-1",
                    "4.87488304496324715063356722168914018093e-2",
                    "1.15106082041721012436439208357739139578e-2",
                    "1.91744691940169259573871742836817806248e-3",
                    "2.40707390548486625606656777332664791183e-4",
                    "2.37047148097688601398129659532643297674e-5",
                    "1.88039545021930711122085375901243257574e-6",
                    "1.22254460725736448552173288004145978774e-7",
                    "6.58462349007293730244197837509157696852e-9",
                    "2.95242372547984999431208546685672497090e-10",
                    "1.10113734998651793201123616276573169622e-11",
                    "3.38963677413425618019569452771868834246e-13",
                    "8.45242599273032563942546507899265865936e-15",
                    "1.64855118157117311049698715635863670233e-16",
                    "2.31679318790012894619592273346600264199e-18",
                    "1.97289727214495789126072009268721022605e-20",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "8.10184661848812835285809771940181522329e-1",
                    "3.06179300560230499194426573196970342618e-1",
                    "7.23171547302923911058112454487643162794e-2",
                    "1.20486436116678834807354529081908850425e-2",
                    "1.51239574861351183874145649960640500707e-3",
                    "1.48939385253081273966380467344920741615e-4",
                    "1.18148716720470800170115047757600735127e-5",
                    "7.68156131480770927662478944117713742978e-7",
                    "4.13720275846166334505537351224097058812e-8",
                    "1.85505701632948614345319635028225905820e-9",
                    "6.91876669388212587242659571229471930880e-11",
                    "2.12971661051277278610784329698988278013e-12",
                    "5.31096179726750865531615367639563072055e-14",
                    "1.03579138802970748888093188937926461893e-15",
                    "1.45570688568663643410924100311054014175e-17",
                    "1.23959804461200982866930072222355142173e-19",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_expm16_32 = new(
                new ReadOnlyCollection<Float128>([
                    "1.59150086070234561732507586188017224084e-1",
                    "6.80849532387385837583114307010320459997e-2",
                    "1.41158479406270598752210344238285334672e-2",
                    "1.88824037165656723581890282427897772492e-3",
                    "1.82912940787568736176030025420621547622e-4",
                    "1.36469458704261637785603215754389736108e-5",
                    "8.13801486421774537025334682673091205328e-7",
                    "3.97058432407176502984043208925327069250e-8",
                    "1.60823277541385163663463406307766614689e-9",
                    "5.45016369260792040947272022706860047646e-11",
                    "1.54846457278644736871929319230398689553e-12",
                    "3.67291749890916930953794688556299297735e-14",
                    "7.18742803398417392282841454979723852423e-16",
                    "1.13337431668170547244474715030235433597e-17",
                    "1.37782648734897338547414800391203459036e-19",
                    "1.17863064141234633971470839644872485483e-21",
                    "5.58768205048500915346781559321978174829e-24",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "4.27782279546086824129750042200649907991e-1",
                    "8.86934772625607907724733810228981095894e-2",
                    "1.18640923531164938140838239032346416143e-2",
                    "1.14927915778694317602192656254187608215e-3",
                    "8.57462121236985574785071163024761935943e-5",
                    "5.11326475640883361512750692176665937785e-6",
                    "2.49479333407835032831192117009600622344e-7",
                    "1.01048164044583907219965175201239136609e-8",
                    "3.42444147056333448589159611785359705792e-10",
                    "9.72928365136507710372724683325279209464e-12",
                    "2.30776323450676114149657959931149982200e-13",
                    "4.51599272091669693373558919762006698549e-15",
                    "7.12120236145539526122748260176385899774e-17",
                    "8.65713807525694136400636427188839379484e-19",
                    "7.40555520515542383952495965093730818381e-21",
                    "3.51084407433793180162386990118245623958e-23",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_expm32_64 = new(
                new ReadOnlyCollection<Float128>([
                    "1.59154943017783040087729009335921759322e-1",
                    "6.35955784629344586058432079844665517425e-2",
                    "1.24333525582177610783141409282489279582e-2",
                    "1.58257137499954581519132407255793210808e-3",
                    "1.47191495695958634792434622715063010854e-4",
                    "1.06408464185207904662485396901099847317e-5",
                    "6.20796977470988464880970001894205834196e-7",
                    "2.99451680244976178843047944033382023574e-8",
                    "1.21331607817814211329055723244764031561e-9",
                    "4.16997758215752306644496702331954449485e-11",
                    "1.22151810180865778439184946086488092970e-12",
                    "3.05017329554372903197056366604190738772e-14",
                    "6.45919279055502465343977575104142733356e-16",
                    "1.14611865933281087898817644094411667861e-17",
                    "1.66574579315129285098834562564888533591e-19",
                    "1.90098275536617376789480602467351545227e-21",
                    "1.56200324658873566425094389271790730206e-23",
                    "7.35526648761411463124801128103381691418e-26",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "3.99582804063194774835771688139366152937e-1",
                    "7.81210581320456331960539046132284190053e-2",
                    "9.94358920922810097599951120081974275145e-3",
                    "9.24831443209858422294319043037419780210e-4",
                    "6.68584098673893150929178892200446909375e-5",
                    "3.90058244779420124535106788512940199547e-6",
                    "1.88151039746201934320258158884886191886e-7",
                    "7.62348975553160355852344937226490493460e-9",
                    "2.62007418751593938350474825754731470453e-10",
                    "7.67502458979132962529935588245058477825e-12",
                    "1.91648040348401277706598232576212305626e-13",
                    "4.05843052379331618504561151714467880641e-15",
                    "7.20127592059771206959014911028588129920e-17",
                    "1.04661894930286305556240859086772458465e-18",
                    "1.19442269177165740287568170417649762849e-20",
                    "9.81435584873372180820418114652670864136e-23",
                    "4.62145023253666168339801687459484937001e-25",
                ])
            );

            private static readonly (ReadOnlyCollection<Float128> numer, ReadOnlyCollection<Float128> denom) pade_plus_expm64_128 = new(
                new ReadOnlyCollection<Float128>([
                    "1.59154943091895335751628149866310390641e-1",
                    "6.91164927854420277537616294413463565970e-2",
                    "1.47557801928232619499125670863084398577e-2",
                    "2.06172621625221091203249391660455847328e-3",
                    "2.11720157411653968975956625234656001375e-4",
                    "1.70086412127379161257840749700428137407e-5",
                    "1.11069186177775505692019195793079552937e-6",
                    "6.04581765901792649215653828121992908775e-8",
                    "2.78996797234624395264657873201296117159e-9",
                    "1.10365978021268853654282661591051834468e-10",
                    "3.76744621013787434243259445839624450867e-12",
                    "1.11110170303355425599446515240949433934e-13",
                    "2.83669090335022069229153919882930282425e-15",
                    "6.09633460833089193733622172621696983652e-17",
                    "1.16200852052266861122422190933586966917e-18",
                    "1.47795810090424252745150042033544310609e-20",
                    "2.35722092370326505616747155207965300634e-22",
                    "8.98381676423023212724768510437325359364e-51",
                ]),
                new ReadOnlyCollection<Float128>([
                    1,
                    "4.34271731953273239691423485699928257808e-1",
                    "9.27133013035186849140772481980360839559e-2",
                    "1.29542078693828543560388747333519393752e-2",
                    "1.33027698228265344561650492600955601983e-3",
                    "1.06868444562964057795387778972002636261e-4",
                    "6.97868278672593071151212650783507879919e-6",
                    "3.79869926850283188785885503049178903204e-7",
                    "1.75298857713475428388051708713106549590e-8",
                    "6.93449891515741631942400181171061740767e-10",
                    "2.36715626731277089044713008494971829270e-11",
                    "6.98125789528264426960496891930942311971e-13",
                    "1.78234546049400950544724588355539821858e-14",
                    "3.83044000387150792693434128054414524740e-16",
                    "7.30111486296552039483196431122555524886e-18",
                    "9.28628462422858135083238952377446358986e-20",
                    "1.48108558735886480298604270981393793162e-21",
                ])
            );

            public static Float128 Value(Float128 x) {
                if (x > 0.5) {
                    return -Value(1d - x);
                }

                Float128 v;
                long exponent = x.Exponent;

                if (exponent >= -2) {
                    Float128 u = -Float128.Log2(Float128.Ldexp(x, 1));

                    if (u <= 0.125) {
                        v = ApproxUtil.Pade(u, pade_plus_expm1_1p125);
                    }
                    else if (u <= 0.25) {
                        v = ApproxUtil.Pade(u - 0.125, pade_plus_expm1p125_1p25);
                    }
                    else if (u <= 0.5) {
                        v = ApproxUtil.Pade(u - 0.25, pade_plus_expm1p25_1p5);
                    }
                    else {
                        v = ApproxUtil.Pade(u - 0.5, pade_plus_expm1p5_2);
                    }
                }
                else if (exponent >= -4) {
                    v = ApproxUtil.Pade(-Float128.Log2(Float128.Ldexp(x, 2)), pade_plus_expm2_4);
                }
                else if (exponent >= -8) {
                    v = ApproxUtil.Pade(-Float128.Log2(Float128.Ldexp(x, 4)), pade_plus_expm4_8);
                }
                else if (exponent >= -16) {
                    v = ApproxUtil.Pade(-Float128.Log2(Float128.Ldexp(x, 8)), pade_plus_expm8_16);
                }
                else if (exponent >= -32) {
                    v = ApproxUtil.Pade(-Float128.Log2(Float128.Ldexp(x, 16)), pade_plus_expm16_32);
                }
                else if (exponent >= -64) {
                    v = ApproxUtil.Pade(-Float128.Log2(Float128.Ldexp(x, 32)), pade_plus_expm32_64);
                }
                else if (exponent >= -128) {
                    v = ApproxUtil.Pade(-Float128.Log2(Float128.Ldexp(x, 64)), pade_plus_expm64_128);
                }
                else {
                    v = Float128.Ldexp(Float128.RcpPI, -1);
                }

                Float128 y = v / (x * x);

                return y;
            }
        }
    }
}